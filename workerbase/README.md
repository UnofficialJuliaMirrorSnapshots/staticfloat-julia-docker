worker base docker images
=========================

To build Julia worker base docker images, run `make` in this directory to generate `Dockerfile` directories within `build`, then run `make <image name>`.  The result will be docker images named things like `julia_workerbase_centos5_11:x64` and `julia_workerbase_ubuntu16_04:x86`.  These images are what are deployed onto in order to create buildworkers, as these images contain things like very recent versions of `gcc`, `python`, `cmake`, etc...

To generate all the `Dockerfile`s without actually building the docker images, run `make`, or `make dockerfiles`, if you like to be verbose.  This is the default behavior.

To generate a `Dockerfile` and then build the result, run something like `make centos5_11-x86`, or `make ubuntu16_04-x64`.

To generate all `Dockerfile`s and then build all results, run `make buildall`.  Note that this will automatically skip buildworkers that are on an incompatible architecture (e.g. an `x64` machine will only ever build `x86` and `x64` images, not `ppc64le` images)

To push the resulting docker images to the Docker Hub, run `make pushall`, or `make push-centos5_11-x86` to push only a single image.  You must have logged into an authorized Docker Hub account on your local docker daemon for this to work, of course.

**NOTE:** This repository uses the new experimental `--squash` command introduced in Docker 1.13 in order to cut down on image sizes (Without `--squash` support, the `centos5_11-x86` image is ~6.5 GB, while with it it is a mere ~1.3 GB). While the actual `Dockerfile`s generated by this repository do not have anything experimental within them, the `Makefile` within this repository will attempt to pass `--squash` to `docker build` if it can (e.g. if `--squash` is listed withing `docker build --help`).  If you are not running a `dockerd` new enough, or with the `experimental` setting set to false, then `--squash` will not be used and your images will be significantly larger.

## Multiarch support
Experimental multiarch support is being added for all non-`x86` architectures. All non-`x86` images have a `qemu-*-static` binary in `/usr/bin` that can be used as the entrypoint on an `x86_64` machine.  This allows normal usage of the docker image as if it were being used on a native hardware stack of whatever exotic architecture you desire.

To run e.g. the `armv7l` buildbot image on your `x86_64` system using QEMU for emulation, first run the `qemu_register.sh` script with `sudo` to register the `qemu` paths within docker containers as a valid interpreter for foreign `armv7l`, `aarch64` and `ppc64le` binaries.  You can then run the docker image directly, e.g. `docker run -ti staticfloat/julia_workerbase:debian7_11-armv7l`
